<!DOCTYPE html>
<html>
<head>
    <title>Kobo Toolbox to Tableau Connector</title>
    <script src="https://connectors.tableau.com/libs/tableauwdc-2.3.latest.js"></script>
    <script>
        (function() {
            var myConnector = tableau.makeConnector();

            myConnector.getSchema = function(schemaCallback) {
                // Tableau will auto-detect schema from CSV
                schemaCallback([]);
            };

            myConnector.getData = function(table, doneCallback) {
                $.get("https://raw.githubusercontent.com/imad479/kobo-tableau-sync/main/kobo_data.csv")
                    .done(function(csvData) {
                        table.appendRows($.csv.toObjects(csvData));
                        doneCallback();
                    });
            };

            tableau.registerConnector(myConnector);
            
            $(document).ready(function() {
                $("#submitButton").click(function() {
                    tableau.connectionName = "Kobo Toolbox Data";
                    tableau.submit();
                });
            });
        })();
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.11/jquery.csv.min.js"></script>
</head>
<body>
    <h1>Kobo Toolbox Data Connector</h1>
    <button id="submitButton">Load Kobo Data</button>
</body>
</html>
