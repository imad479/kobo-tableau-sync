<!DOCTYPE html>
<html>
<head>
    <title>Kobo Toolbox to Tableau Connector</title>
    <script src="https://connectors.tableau.com/libs/tableauwdc-2.3.latest.js"></script>
    <script>
        (function() {
            var myConnector = tableau.makeConnector();

            myConnector.getSchema = function(schemaCallback) {
                schemaCallback([]);
            };

            myConnector.getData = function(table, doneCallback) {
                fetch("https://raw.githubusercontent.com/imad479/kobo-tableau-sync/main/kobo_data.csv")
                .then(response => response.text())
                .then(csvData => {
                    const rows = csvData.split('\n');
                    const headers = rows[0].split(',');
                    
                    const tableData = rows.slice(1).map(row => {
                        const values = row.split(',');
                        return headers.reduce((obj, header, i) => {
                            obj[header] = values[i];
                            return obj;
                        }, {});
                    });
                    
                    table.appendRows(tableData);
                    doneCallback();
                });
            };

            tableau.registerConnector(myConnector);
            
            document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('submitButton').addEventListener('click', function() {
                    tableau.connectionName = "Kobo Toolbox Data";
                    tableau.submit();
                });
            });
        })();
    </script>
</head>
<body>
    <h1>Kobo Toolbox Data Connector</h1>
    <button id="submitButton">Load Kobo Data</button>
</body>
</html>
